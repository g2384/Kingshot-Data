<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Points Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
        }

        .input-group {
            margin: 20px 0;
        }

        input[type="number"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }

        .result {
            margin: 20px 0;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 4px;
        }

        .section {
            margin-bottom: 40px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .table-section {
            overflow-x: auto;
        }

        h2 {
            color: #333;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Points Calculator</h1>

        <div class="input-group">
            <div style="margin-bottom: 10px;">
                <label for="speedBoost">Training Speed Boost (%): </label>
                <input type="number" id="speedBoost" value="0" min="0" step="1">

                <label for="speedupMinutes">Speedup Minutes to Compare: </label>
                <input type="number" id="speedupMinutes" value="1" min="1" step="1">
            </div>

            <div style="margin-bottom: 10px;">
                <label for="maxLevel">Maximum Available Level: </label>
                <select id="maxLevel"></select>

                <label for="currentLevel">Current Level: </label>
                <select id="currentLevel"></select>
            </div>

            <div style="margin-bottom: 10px;">
                <label for="speedupPoints">Points per Speedup Minute: </label>
                <input type="number" id="speedupPoints" value="300" min="1" step="1">

                <label for="powerPoints">Points per Power: </label>
                <input type="number" id="powerPoints" value="20" min="1" step="1">
            </div>

            <div style="margin-bottom: 10px;">
                <label>
                    <input type="checkbox" id="showOnlyCurrentToMax" checked>
                    Only show promotions from current level to max level
                </label>
            </div>
        </div>

        <div class="section">
            <h2>Training Troops</h2>
            <div class="table-section">
                <table id="troopTable">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Training Time (seconds)</th>
                            <th>Power</th>
                            <th>HOG Points</th>
                            <th>SVS Points</th>
                            <th>TSG Points</th>
                            <th>Points per Troop</th>
                            <th>Troops Trainable</th>
                            <th>Total Points</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Promoting Troops</h2>
            <div class="table-section">
                <table id="promotionTable">
                    <thead>
                        <tr>
                            <th>From Level</th>
                            <th>To Level</th>
                            <th>Time (seconds)</th>
                            <th>Power Gain</th>
                            <th>HOG Points Gain</th>
                            <th>SVS Points Gain</th>
                            <th>TSG Points Gain</th>
                            <th>Points per Promotion</th>
                            <th>Promotions Possible</th>
                            <th>Total Points</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>Comparison Analysis</h2>
            <div class="result" id="comparison"></div>

            <div class="chart-container" style="position: relative; height:600px; width:100%; margin-top: 20px;">
                <canvas id="pointsChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        function calculatePointsForType(pointsPerTroop, troopCount){
            return pointsPerTroop * troopCount;
        }

        function calculateTroopsTrainable(trainingTimeSeconds, speedBoost, speedupMinutes) {
            const actualTrainingTimeMinutes = (trainingTimeSeconds / 60) / speedBoost;
            return Math.ceil(speedupMinutes / actualTrainingTimeMinutes);
        }

        const troopData = [
            { level: 1, levelStr: '1', time: 12.00, power: 3, hogPoints: 90, svsPoints: 3, tsgPoints: 1 },
            { level: 2, levelStr: '2', time: 17.00, power: 4, hogPoints: 120, svsPoints: 4, tsgPoints: 2 },
            { level: 3, levelStr: '3', time: 24.00, power: 6, hogPoints: 180, svsPoints: 5, tsgPoints: 3 },
            { level: 4, levelStr: '4', time: 32.00, power: 9, hogPoints: 265, svsPoints: 8, tsgPoints: 5 },
            { level: 5, levelStr: '5', time: 44.00, power: 13, hogPoints: 385, svsPoints: 12, tsgPoints: 7 },
            { level: 6, levelStr: '6', time: 60.00, power: 20, hogPoints: 595, svsPoints: 18, tsgPoints: 11 },
            { level: 7, levelStr: '7', time: 83.00, power: 28, hogPoints: 830, svsPoints: 25, tsgPoints: 16 },
            { level: 8, levelStr: '8', time: 113.00, power: 38, hogPoints: 1130, svsPoints: 35, tsgPoints: 23 },
            { level: 9, levelStr: '9', time: 131.00, power: 50, hogPoints: 1485, svsPoints: 45, tsgPoints: 30 },
            { level: 10, levelStr: '10', time: 152.00, power: 66, hogPoints: 1960, svsPoints: 60, tsgPoints: 39 },
            { level: 11, levelStr: 'TG1', time: 152.00, power: 71, hogPoints: 1960, svsPoints: 60, tsgPoints: 39 },
            { level: 12, levelStr: 'TG2', time: 152.00, power: 76, hogPoints: 1960, svsPoints: 60, tsgPoints: 39 },
            { level: 13, levelStr: 'TG3', time: 152.00, power: 83, hogPoints: 1960, svsPoints: 60, tsgPoints: 39 }
        ];

        function calculatePoints() {
            const speedBoost = 1 + (parseFloat(document.getElementById('speedBoost').value) / 100);
            const speedupMinutes = parseFloat(document.getElementById('speedupMinutes').value);
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const currentLevel = parseInt(document.getElementById('currentLevel').value);
            const pointsPerMinute = parseFloat(document.getElementById('speedupPoints').value);
            const pointsPerPower = parseFloat(document.getElementById('powerPoints').value);
            const showOnlyCurrentToMax = document.getElementById('showOnlyCurrentToMax').checked;
            const speedupPoints = speedupMinutes * pointsPerMinute;

            const tbody = document.querySelector('#troopTable tbody');
            tbody.innerHTML = '';

            const promotionTbody = document.querySelector('#promotionTable tbody');
            promotionTbody.innerHTML = '';

            // Filter troops based on max level
            const availableTroops = troopData.filter(troop => troop.level <= maxLevel);

            availableTroops.forEach(troop => {
                const row = document.createElement('tr');

                const troopsTrainable = calculateTroopsTrainable(troop.time, speedBoost, speedupMinutes);
                
                // Calculate points for each type
                const powerPoints = calculatePointsForType(troop.power * pointsPerPower, troopsTrainable);
                const hogPoints = calculatePointsForType(troop.hogPoints, troopsTrainable);
                const svsPoints = calculatePointsForType(troop.svsPoints, troopsTrainable);
                const tsgPoints = calculatePointsForType(troop.tsgPoints, troopsTrainable);
                
                const totalPoints = troopsTrainable * powerPoints; // Keep total points based on power for now

                row.innerHTML = `
                    <td>${troop.levelStr}</td>
                    <td>${troop.time}</td>
                    <td>${troop.power}</td>
                    <td>${hogPoints}</td>
                    <td>${svsPoints}</td>
                    <td>${tsgPoints}</td>
                    <td>${powerPoints}</td>
                    <td>${troopsTrainable}</td>
                    <td>${totalPoints}</td>
                `;
                tbody.appendChild(row);
            });

            // Update comparison text
            // Calculate promotions
            for (let fromLevel = 1; fromLevel < maxLevel; fromLevel++) {
                for (let toLevel = fromLevel + 1; toLevel <= maxLevel; toLevel++) {
                    if (showOnlyCurrentToMax) {
                        // When checkbox is checked, only show promotions TO max level FROM each level
                        if (toLevel !== maxLevel) continue;
                    }

                    const fromTroop = troopData.find(t => t.level === fromLevel);
                    const toTroop = troopData.find(t => t.level === toLevel);

                    const timeDiff = toTroop.time - fromTroop.time;
                    const powerGain = toTroop.power - fromTroop.power;
                    const pointsPerPromotion = powerGain * pointsPerPower;
                    const promotionTimeMinutes = timeDiff / 60 / speedBoost;
                    const possiblePromotions = Math.floor(speedupMinutes / promotionTimeMinutes);
                    const totalPoints = possiblePromotions * pointsPerPromotion;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${fromLevel}</td>
                        <td>${toLevel}</td>
                        <td>${timeDiff.toFixed(2)}</td>
                        <td>${powerGain}</td>
                        <td>${pointsPerPromotion}</td>
                        <td>${possiblePromotions}</td>
                        <td>${totalPoints}</td>
                    `;
                    promotionTbody.appendChild(row);
                }
            }

            const comparisonDiv = document.getElementById('comparison');
            const bestTrainingPoints = Math.max(...availableTroops.map(troop => {
                const actualTrainingTimeMinutes = (troop.time / 60) / speedBoost;
                const troopsTrainable = Math.floor(speedupMinutes / actualTrainingTimeMinutes);
                return troopsTrainable * troop.power * 20;
            }));

            const bestPromotionPoints = Math.max(...Array.from(promotionTbody.querySelectorAll('tr'))
                .map(row => parseInt(row.cells[6].textContent) || 0));

            comparisonDiv.innerHTML = `
                <h3>Comparison for ${speedupMinutes} minute(s) of speedup:</h3>
                <p>Points from using speedups directly: ${speedupPoints}</p>
                <p>Training speed boost: ${((speedBoost - 1) * 100).toFixed(1)}%</p>
                <p>Best points from training troops: ${bestTrainingPoints}</p>
                <p>Best points from promoting troops: ${bestPromotionPoints}</p>
            `;
        }

        // Populate the level dropdowns
        function populateLevelDropdowns() {
            const maxLevelSelect = document.getElementById('maxLevel');
            const currentLevelSelect = document.getElementById('currentLevel');
            
            // Clear existing options
            maxLevelSelect.innerHTML = '';
            currentLevelSelect.innerHTML = '';
            
            // Add options for each troop level
            troopData.forEach(troop => {
                const maxOption = new Option(troop.levelStr, troop.level);
                const currentOption = new Option(troop.levelStr, troop.level);
                
                if (troop.level === 9) maxOption.selected = true;
                if (troop.level === 1) currentOption.selected = true;
                
                maxLevelSelect.add(maxOption);
                currentLevelSelect.add(currentOption);
            });
        }

        // Initialize dropdowns
        populateLevelDropdowns();

        // Add event listeners
        document.getElementById('speedBoost').addEventListener('input', calculatePoints);
        document.getElementById('speedupMinutes').addEventListener('input', calculatePoints);

        // Chart configuration
        let pointsChart;

        function updateChart() {
            const speedBoost = 1 + (parseFloat(document.getElementById('speedBoost').value) / 100);
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const currentLevel = parseInt(document.getElementById('currentLevel').value);
            const pointsPerMinute = parseFloat(document.getElementById('speedupPoints').value);
            const pointsPerPower = parseFloat(document.getElementById('powerPoints').value);
            const showOnlyCurrentToMax = document.getElementById('showOnlyCurrentToMax').checked;
            const minutes = Array.from({ length: 60 }, (_, i) => i + 1); // X-axis values from 1 to 60 minutes

            // Calculate points for speedups
            const speedupData = minutes.map(min => min * 300);

            // Calculate points for each troop level
            const availableTroops = troopData.filter(troop => troop.level <= maxLevel);
            const troopDatasets = availableTroops.map(troop => {
                const points = minutes.map(min => {
                    const actualTrainingTimeMinutes = (troop.time / 60) / speedBoost;
                    const troopsTrainable = Math.floor(min / actualTrainingTimeMinutes);
                    return troopsTrainable * troop.power * 20;
                });

                return {
                    label: `Level ${troop.level} Troops`,
                    data: points,
                    borderWidth: 1,
                    fill: false
                };
            });

            // Calculate promotion datasets
            const promotionDatasets = [];
            for (let fromLevel = 1; fromLevel < maxLevel; fromLevel++) {
                // Skip levels below current level if showOnlyCurrentToMax is checked
                if (showOnlyCurrentToMax && fromLevel < currentLevel) continue;

                for (let toLevel = fromLevel + 1; toLevel <= maxLevel; toLevel++) {
                    // When checkbox is checked, only show promotions TO max level
                    if (showOnlyCurrentToMax && toLevel !== maxLevel) continue;

                    const fromTroop = troopData.find(t => t.level === fromLevel);
                    const toTroop = troopData.find(t => t.level === toLevel);

                    const timeDiff = toTroop.time - fromTroop.time;
                    const powerGain = toTroop.power - fromTroop.power;
                    const pointsPerPromotion = powerGain * pointsPerPower;

                    const points = minutes.map(min => {
                        const promotionTimeMinutes = timeDiff / 60 / speedBoost;
                        const possiblePromotions = Math.floor(min / promotionTimeMinutes);
                        return possiblePromotions * pointsPerPromotion;
                    });

                    promotionDatasets.push({
                        label: `Promote ${fromLevel}â†’${toLevel}`,
                        data: points,
                        borderWidth: 1,
                        fill: false,
                        borderDash: [5, 5] // Make promotion lines dashed
                    });
                }
            }

            // Add speedup line and all datasets
            const datasets = [
                {
                    label: 'Speedup Points',
                    data: speedupData,
                    borderColor: 'rgb(255, 99, 132)',
                    borderWidth: 2,
                    fill: false
                },
                ...troopDatasets,
                ...promotionDatasets
            ];

            // Destroy existing chart if it exists
            if (pointsChart) {
                pointsChart.destroy();
            }

            // Create new chart
            const ctx = document.getElementById('pointsChart').getContext('2d');
            pointsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: minutes,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Minutes'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Points Earned'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Points Comparison: Speedups vs Troop Training'
                        },
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Update both calculations and chart when inputs change
        function updateAll() {
            calculatePoints();
            updateChart();
        }

        // Add event listeners
        document.getElementById('speedBoost').addEventListener('input', updateAll);
        document.getElementById('speedupMinutes').addEventListener('input', updateAll);
        document.getElementById('maxLevel').addEventListener('input', updateAll);
        document.getElementById('currentLevel').addEventListener('input', updateAll);
        document.getElementById('speedupPoints').addEventListener('input', updateAll);
        document.getElementById('powerPoints').addEventListener('input', updateAll);
        document.getElementById('showOnlyCurrentToMax').addEventListener('change', updateAll);

        // Initial calculation and chart
        updateAll();
    </script>
</body>

</html>