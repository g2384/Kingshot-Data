<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Points Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        td:nth-child(n+2):not(:nth-child(1)) {
            text-align: right;
        }

        /* Monospace font for numeric cells */
        td:nth-child(n+2) {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        th {
            background-color: #f8f9fa;
        }

        .input-group {
            margin: 20px 0;
            display: grid;
            gap: 1rem;
        }

        .input-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-field label {
            font-weight: 500;
            color: #333;
        }

        .input-field .hint {
            font-size: 0.9em;
            color: #666;
            margin-top: 0.25rem;
        }

        input[type="number"],
        select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-width: 200px;
            font-size: 1rem;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        @media (max-width: 768px) {
            .input-group {
                gap: 1.5rem;
            }

            input[type="number"],
            select {
                max-width: 100%;
            }
        }

        .table-section {
            overflow-x: auto;
        }

        h2 {
            color: #333;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Points Calculator</h1>

        <div>
            <h3>TL;DR - Key Points</h3>
            <ul>
                <li>Assume that level 4 troops are unlocked</li>
                <li>Promote troops instead of training new ones</li>
                <li>Use speedups during <i>"Train 1 Level x Troop(s)"</i> stage, <b>not</b> <i>"Use 1m of Speedups for
                        Troop Training or Promotion"</i> stage</li>
                <li>During Hall of Governors event, use speedups in <i>Training Troops</i> stage, <b>not</b> <i>Power
                        Boost</i> stage</li>
            </ul>
        </div>

        <div class="input-group">
            <h2>Inputs</h2>
            <div class="input-field">
                <label for="speedBoost">Training Speed Boost (%)</label>
                <input type="number" id="speedBoost" value="100" min="0" step="1">
                <span class="hint">Find this number by clicking on fist icon at the top → Bonus Overview → Military →
                    Training Speed</span>
            </div>

            <div class="input-field">
                <label for="speedupMinutes">Total Training Time or Speedup Minutes to Compare</label>
                <input type="number" id="speedupMinutes" value="100" min="1" step="1">
                <span class="hint">Rounds up training time - e.g., 5m59s counts as 5 minutes if you can wait for the
                    remaining seconds</span>
            </div>

            <div class="input-field">
                <label for="maxLevel">Maximum Troop Level</label>
                <select id="maxLevel"></select>
            </div>

            <div class="input-field">
                <label for="currentLevel">Starting Level for Promotion</label>
                <select id="currentLevel"></select>
            </div>

            <div class="input-field">
                <label class="checkbox-label" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="checkbox" id="showOnlyCurrentToMax" checked>
                    <span>Only show promotions from current level to max level</span>
                </label>
            </div>
        </div>

        <div>
            <h3>Column Explanations</h3>
            <ul>
                <li><strong>HOG Points (Train Troops)</strong>: Points earned in the Hall of Governors event's Train
                    Troops
                    stage.</li>
                <li><strong>HOG Points (Power Boost)</strong>: Points earned in the Hall of Governors event's Power
                    Boost stage. Default is 20 points per power increase, you can adjust this value using the 'Points
                    per Power' option</li>
                <li><strong>KVK Points</strong>: Points earned during the Kingdom versus Kingdom (KvK) Power event.</li>
                <li><strong>STG Points</strong>: Points earned in the Strongest Governor event.</li>
            </ul>
        </div>

        <h2>Training Troops</h2>
        <div class="table-section">
            <table id="troopTable">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>Time (s)</th>
                        <th>Troops Trainable</th>
                        <th>Power Increase</th>
                        <th>HOG Points (Train Troops)</th>
                        <th>HOG Points (Power Boost)</th>
                        <th>KVK Points</th>
                        <th>STG Points</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <h2>Promoting Troops</h2>
        <div class="table-section">
            <table id="promotionTable">
                <thead>
                    <tr>
                        <th>From Level</th>
                        <th>To Level</th>
                        <th>Time (s)</th>
                        <th>Promotions Possible</th>
                        <th>Power Increase</th>
                        <th>HOG Points (Train Troops)</th>
                        <th>HOG Points (Power Boost)</th>
                        <th>KVK Points</th>
                        <th>STG Points</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <h2>Total Points Summary</h2>

        <div style="margin: 20px 0; padding: 15px; background-color: #f8f9fa; border-radius: 4px;">
            <strong>Note:</strong> During Hall of Governors, Hero Development stage, each speedup minute is worth 300 points, when using speedups for Troop Training or Promotion
        </div>

        <div class="table-section">
            <table id="summaryTable">
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>HOG Points</th>
                        <th>Power Points</th>
                        <th>KVK Points</th>
                        <th>STG Points</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="speedupRow">
                        <td>Using Speedups (300 points per minute)</td>
                        <td id="speedupHogPoints">-</td>
                        <td>-</td>
                        <td>-</td>
                        <td>-</td>
                    </tr>
                    <tr id="bestTrainingRow">
                        <td>Highest Points From Training</td>
                        <td>(<span id="trainingHogLevel">-</span>) <span id="trainingHogPoints">-</span></td>
                        <td>(<span id="trainingPowerLevel">-</span>) <span id="trainingPowerPoints">-</span></td>
                        <td>(<span id="trainingKvkLevel">-</span>) <span id="trainingKvkPoints">-</span></td>
                        <td>(<span id="trainingStgLevel">-</span>) <span id="trainingStgPoints">-</span></td>
                    </tr>
                    <tr id="bestPromotionRow">
                        <td>Highest Points From Promotion</td>
                        <td>(<span id="promotionHogLevels">-</span>) <span id="promotionHogPoints">-</span></td>
                        <td>(<span id="promotionPowerLevels">-</span>) <span id="promotionPowerPoints">-</span></td>
                        <td>(<span id="promotionKvkLevels">-</span>) <span id="promotionKvkPoints">-</span></td>
                        <td>(<span id="promotionStgLevels">-</span>) <span id="promotionStgPoints">-</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="references-section"
            style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
            <h3 style="margin-top: 0; color: #333;">References</h3>
            <ul style="list-style-type: none; padding-left: 0; margin: 0;">
                <li style="margin: 8px 0;">
                    <a href="https://kingshotdata.com/" target="_blank" style="color: #007bff; text-decoration: none;">
                        KingShot Data
                    </a>
                </li>
                <li style="margin: 8px 0;">
                    <a href="https://kingshotcalculator.com/troop-training-and-promotion-calculator/" target="_blank"
                        style="color: #007bff; text-decoration: none;">
                        KingShot Calculator - Troop Training and Promotion Calculator
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <script>
        function calculatePointsForType(pointsPerTroop, troopCount) {
            return pointsPerTroop * troopCount;
        }

        function calculateTroopsTrainable(trainingTimeSeconds, speedBoost, speedupMinutes) {
            const actualTrainingTimeMinutes = (trainingTimeSeconds / 60) / (speedBoost);
            return Math.ceil(speedupMinutes / actualTrainingTimeMinutes);
        }

        const formatNumber = (num) => num.toLocaleString();

        const troopData = [
            { level: 1, levelStr: '1', time: 12.00, power: 3, hogPoints: 90, kvkPoints: 3, stgPoints: 1 },
            { level: 2, levelStr: '2', time: 17.00, power: 4, hogPoints: 120, kvkPoints: 4, stgPoints: 2 },
            { level: 3, levelStr: '3', time: 24.00, power: 6, hogPoints: 180, kvkPoints: 5, stgPoints: 3 },
            { level: 4, levelStr: '4', time: 32.00, power: 9, hogPoints: 265, kvkPoints: 8, stgPoints: 5 },
            { level: 5, levelStr: '5', time: 44.00, power: 13, hogPoints: 385, kvkPoints: 12, stgPoints: 7 },
            { level: 6, levelStr: '6', time: 60.00, power: 20, hogPoints: 595, kvkPoints: 18, stgPoints: 11 },
            { level: 7, levelStr: '7', time: 83.00, power: 28, hogPoints: 830, kvkPoints: 25, stgPoints: 16 },
            { level: 8, levelStr: '8', time: 113.00, power: 38, hogPoints: 1130, kvkPoints: 35, stgPoints: 23 },
            { level: 9, levelStr: '9', time: 131.00, power: 50, hogPoints: 1485, kvkPoints: 45, stgPoints: 30 },
            { level: 10, levelStr: '10', time: 152.00, power: 66, hogPoints: 1960, kvkPoints: 60, stgPoints: 39 },
            { level: 11, levelStr: 'TG1', time: 152.00, power: 71, hogPoints: 1960, kvkPoints: 60, stgPoints: 39 },
            { level: 12, levelStr: 'TG2', time: 152.00, power: 76, hogPoints: 1960, kvkPoints: 60, stgPoints: 39 },
            { level: 13, levelStr: 'TG3', time: 152.00, power: 83, hogPoints: 1960, kvkPoints: 60, stgPoints: 39 }
        ];

        function calculatePoints() {
            const speedBoost = 1 + (parseFloat(document.getElementById('speedBoost').value) / 100);
            const speedupMinutes = parseFloat(document.getElementById('speedupMinutes').value);
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const currentLevel = parseInt(document.getElementById('currentLevel').value);
            const pointsPerMinute = 300; // Fixed value for speedup points
            const pointsPerPower = 20; // Fixed value for power points
            const showOnlyCurrentToMax = document.getElementById('showOnlyCurrentToMax').checked;
            const speedupPoints = speedupMinutes * pointsPerMinute;

            const tbody = document.querySelector('#troopTable tbody');
            tbody.innerHTML = '';

            const promotionTbody = document.querySelector('#promotionTable tbody');
            promotionTbody.innerHTML = '';

            // Filter troops based on max level
            const availableTroops = troopData.filter(troop => troop.level <= maxLevel);

            availableTroops.forEach(troop => {
                const row = document.createElement('tr');

                console.log(troop.time, speedBoost, speedupMinutes);
                const troopsTrainable = calculateTroopsTrainable(troop.time, speedBoost, speedupMinutes);

                const power = troop.power * troopsTrainable;

                // Calculate points for each type
                const powerPoints = calculatePointsForType(troop.power * pointsPerPower, troopsTrainable);
                const hogPoints = calculatePointsForType(troop.hogPoints, troopsTrainable);
                const kvkPoints = calculatePointsForType(troop.kvkPoints, troopsTrainable);
                const stgPoints = calculatePointsForType(troop.stgPoints, troopsTrainable);

                row.innerHTML = `
                    <td>${troop.levelStr}</td>
                    <td>${troop.time}</td>
                    <td>${formatNumber(troopsTrainable)}</td>
                    <td>${formatNumber(power)}</td>
                    <td>${formatNumber(hogPoints)}</td>
                    <td>${formatNumber(powerPoints)}</td>
                    <td>${formatNumber(kvkPoints)}</td>
                    <td>${formatNumber(stgPoints)}</td>
                `;
                tbody.appendChild(row);
            });

            // Update comparison text
            // Calculate promotions
            for (let fromLevel = 1; fromLevel < maxLevel; fromLevel++) {
                for (let toLevel = fromLevel + 1; toLevel <= maxLevel; toLevel++) {
                    if (showOnlyCurrentToMax) {
                        // When checkbox is checked, only show promotions TO max level FROM each level
                        if (toLevel !== maxLevel) continue;
                    }

                    if (toLevel > 10 && fromLevel >= 10) {
                        continue;
                    }

                    const fromTroop = troopData.find(t => t.level === fromLevel);
                    const toTroop = troopData.find(t => t.level === toLevel);

                    const timeDiff = toTroop.time - fromTroop.time;

                    const possiblePromotions = calculateTroopsTrainable(timeDiff, speedBoost, speedupMinutes);

                    const powerGain = toTroop.power - fromTroop.power;
                    const pointsPerPromotion = powerGain * pointsPerPower;

                    // Apply number of possible promotions to get total points
                    const totalPowerPoints = possiblePromotions * powerGain * pointsPerPower;
                    const totalHogPoints = possiblePromotions * (toTroop.hogPoints - fromTroop.hogPoints);
                    const totalKvkPoints = possiblePromotions * (toTroop.kvkPoints - fromTroop.kvkPoints);
                    const totalStgPoints = possiblePromotions * (toTroop.stgPoints - fromTroop.stgPoints);

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${fromTroop.levelStr}</td>
                        <td>${toTroop.levelStr}</td>
                        <td>${timeDiff}</td>
                        <td>${formatNumber(possiblePromotions)}</td>
                        <td>${formatNumber(possiblePromotions * powerGain)}</td>
                        <td>${formatNumber(totalHogPoints)}</td>
                        <td>${formatNumber(totalPowerPoints)}</td>
                        <td>${formatNumber(totalKvkPoints)}</td>
                        <td>${formatNumber(totalStgPoints)}</td>
                    `;
                    promotionTbody.appendChild(row);
                }
            }
        }

        // Populate the level dropdowns
        function populateLevelDropdowns() {
            const maxLevelSelect = document.getElementById('maxLevel');
            const currentLevelSelect = document.getElementById('currentLevel');

            // Clear existing options
            maxLevelSelect.innerHTML = '';
            currentLevelSelect.innerHTML = '';

            // Add options for each troop level
            troopData.forEach(troop => {
                const maxOption = new Option(troop.levelStr, troop.level);
                const currentOption = new Option(troop.levelStr, troop.level);

                if (troop.level === 9) maxOption.selected = true;
                if (troop.level === 1) currentOption.selected = true;

                maxLevelSelect.add(maxOption);
                currentLevelSelect.add(currentOption);
            });
        }

        // Initialize dropdowns
        populateLevelDropdowns();

        // Add event listeners
        document.getElementById('speedBoost').addEventListener('input', calculatePoints);
        document.getElementById('speedupMinutes').addEventListener('input', calculatePoints);

        function updateSummary() {
            const speedupMinutes = parseFloat(document.getElementById('speedupMinutes').value);
            const pointsPerMinute = 300; // Fixed value for speedup points
            const speedBoost = 1 + (parseFloat(document.getElementById('speedBoost').value) / 100);
            const maxLevel = parseInt(document.getElementById('maxLevel').value);
            const currentLevel = parseInt(document.getElementById('currentLevel').value);
            const pointsPerPower = 20; // Fixed value for power points

            // Calculate speedup points
            const speedupPoints = speedupMinutes * pointsPerMinute;
            document.getElementById('speedupHogPoints').textContent = speedupPoints;

            // Find best training option
            let bestTrainingHogPoints = 0;
            let bestTrainingPowerPoints = 0;
            let bestTrainingKvkPoints = 0;
            let bestTrainingStgPoints = 0;
            let bestHogLevel = '-';
            let bestPowerLevel = '-';
            let bestKvkLevel = '-';
            let bestStgLevel = '-';

            troopData.filter(troop => troop.level <= maxLevel).forEach(troop => {
                const troopsTrainable = calculateTroopsTrainable(troop.time, speedBoost, speedupMinutes);
                const hogPoints = troopsTrainable * troop.hogPoints;
                const powerPoints = troopsTrainable * troop.power * pointsPerPower;
                const kvkPoints = troopsTrainable * troop.kvkPoints;
                const stgPoints = troopsTrainable * troop.stgPoints;

                if (hogPoints > bestTrainingHogPoints) {
                    bestTrainingHogPoints = hogPoints;
                    bestHogLevel = troop.levelStr;
                }
                if (powerPoints > bestTrainingPowerPoints) {
                    bestTrainingPowerPoints = powerPoints;
                    bestPowerLevel = troop.levelStr;
                }
                if (kvkPoints > bestTrainingKvkPoints) {
                    bestTrainingKvkPoints = kvkPoints;
                    bestKvkLevel = troop.levelStr;
                }
                if (stgPoints > bestTrainingStgPoints) {
                    bestTrainingStgPoints = stgPoints;
                    bestStgLevel = troop.levelStr;
                }
            });

            // Find best promotion option
            let bestPromotionHogPoints = 0;
            let bestPromotionPowerPoints = 0;
            let bestPromotionKvkPoints = 0;
            let bestPromotionStgPoints = 0;
            let bestHogPromotionLevels = '-';
            let bestPowerPromotionLevels = '-';
            let bestKvkPromotionLevels = '-';
            let bestStgPromotionLevels = '-';

            for (let fromLevel = currentLevel; fromLevel < maxLevel; fromLevel++) {
                for (let toLevel = fromLevel + 1; toLevel <= maxLevel; toLevel++) {
                    if (toLevel > 10 && fromLevel >= 10) continue;

                    const fromTroop = troopData.find(t => t.level === fromLevel);
                    const toTroop = troopData.find(t => t.level === toLevel);
                    const timeDiff = toTroop.time - fromTroop.time;
                    const possiblePromotions = calculateTroopsTrainable(timeDiff, speedBoost, speedupMinutes);

                    const hogPoints = possiblePromotions * (toTroop.hogPoints - fromTroop.hogPoints);
                    const powerPoints = possiblePromotions * (toTroop.power - fromTroop.power) * pointsPerPower;
                    const kvkPoints = possiblePromotions * (toTroop.kvkPoints - fromTroop.kvkPoints);
                    const stgPoints = possiblePromotions * (toTroop.stgPoints - fromTroop.stgPoints);

                    if (hogPoints > bestPromotionHogPoints) {
                        bestPromotionHogPoints = hogPoints;
                        bestHogPromotionLevels = `${fromTroop.levelStr}→${toTroop.levelStr}`;
                    }
                    if (powerPoints > bestPromotionPowerPoints) {
                        bestPromotionPowerPoints = powerPoints;
                        bestPowerPromotionLevels = `${fromTroop.levelStr}→${toTroop.levelStr}`;
                    }
                    if (kvkPoints > bestPromotionKvkPoints) {
                        bestPromotionKvkPoints = kvkPoints;
                        bestKvkPromotionLevels = `${fromTroop.levelStr}→${toTroop.levelStr}`;
                    }
                    if (stgPoints > bestPromotionStgPoints) {
                        bestPromotionStgPoints = stgPoints;
                        bestStgPromotionLevels = `${fromTroop.levelStr}→${toTroop.levelStr}`;
                    }
                }
            }

            // Update summary table
            document.getElementById('trainingHogPoints').textContent = formatNumber(Math.floor(bestTrainingHogPoints));
            document.getElementById('trainingPowerPoints').textContent = formatNumber(Math.floor(bestTrainingPowerPoints));
            document.getElementById('trainingKvkPoints').textContent = formatNumber(Math.floor(bestTrainingKvkPoints));
            document.getElementById('trainingStgPoints').textContent = formatNumber(Math.floor(bestTrainingStgPoints));

            document.getElementById('trainingHogLevel').textContent = bestHogLevel;
            document.getElementById('trainingPowerLevel').textContent = bestPowerLevel;
            document.getElementById('trainingKvkLevel').textContent = bestKvkLevel;
            document.getElementById('trainingStgLevel').textContent = bestStgLevel;

            document.getElementById('promotionHogPoints').textContent = formatNumber(Math.floor(bestPromotionHogPoints));
            document.getElementById('promotionPowerPoints').textContent = formatNumber(Math.floor(bestPromotionPowerPoints));
            document.getElementById('promotionKvkPoints').textContent = formatNumber(Math.floor(bestPromotionKvkPoints));
            document.getElementById('promotionStgPoints').textContent = formatNumber(Math.floor(bestPromotionStgPoints));

            document.getElementById('promotionHogLevels').textContent = bestHogPromotionLevels;
            document.getElementById('promotionPowerLevels').textContent = bestPowerPromotionLevels;
            document.getElementById('promotionKvkLevels').textContent = bestKvkPromotionLevels;
            document.getElementById('promotionStgLevels').textContent = bestStgPromotionLevels;
        }

        function updateAll() {
            calculatePoints();
            updateSummary();
        }

        // Add event listeners
        document.getElementById('speedBoost').addEventListener('input', updateAll);
        document.getElementById('speedupMinutes').addEventListener('input', updateAll);
        document.getElementById('maxLevel').addEventListener('input', updateAll);
        document.getElementById('currentLevel').addEventListener('input', updateAll);
        document.getElementById('showOnlyCurrentToMax').addEventListener('change', updateAll);

        // Initial calculation and chart
        updateAll();
    </script>
</body>

</html>